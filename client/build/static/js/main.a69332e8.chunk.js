(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{31:function(e,t,a){e.exports=a(81)},36:function(e,t,a){},69:function(e,t,a){e.exports=a.p+"static/media/logo.5d5d9eef.svg"},70:function(e,t,a){},72:function(e,t,a){},76:function(e,t,a){},81:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(12),o=a.n(s),c=a(82),i=(a(36),a(84)),u=a(83),m=a(10),l=a(4),h=a(5),d=a(8),p=a(6),f=a(9),g=a(16),b=a.n(g),v=a(27),E=a.n(v),j=(a(69),a(70),a(72),function(e){var t,a=e.currentUser===e.message.senderId?" u-background-blue u-text-white ":" u-background-gray ";return r.a.createElement("div",{className:"message-container"},r.a.createElement("div",{className:"message-avatar"},r.a.createElement("img",{src:(t=e.message.senderId,"https://ui-avatars.com/api/?name=".concat(t,"&size=32&rounded=true")),alt:""})),r.a.createElement("div",{className:"message"},r.a.createElement("div",{className:"message-username"}," ",e.message.senderId,": "),r.a.createElement("div",{className:"message-text"+a},r.a.createElement("span",null,e.message.text))))}),y=function(e){function t(){return Object(l.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentDidUpdate",value:function(){var e=o.a.findDOMNode(this);e.scrollTop+e.clientHeight+208>=e.scrollHeight&&(e.scrollTop=e.scrollHeight)}},{key:"render",value:function(){var e=this;return this.props.roomId?r.a.createElement("div",{className:"message-list"},this.props.messages.map(function(t,a){return r.a.createElement(j,{key:a,currentUser:e.props.currentUser,message:t})})):r.a.createElement("div",{className:"message-list"},r.a.createElement("div",{className:"join-room"},"\u2190 Join a room!"))}}]),t}(n.Component),O=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={message:""},a.handleChange=function(e){a.setState({message:e.target.value})},a.handleSubmit=function(e){e.preventDefault(),a.props.handleSendMessage(a.state.message),a.setState({message:""})},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return r.a.createElement("form",{onSubmit:this.handleSubmit,className:"send-message-form"},r.a.createElement("input",{disabled:this.props.disabled,placeholder:"Write a message...",type:"text",onChange:this.handleChange,value:this.state.message}))}}]),t}(n.Component),S=function(e){var t=Object(m.a)(e.rooms).sort(function(e,t){return e.name.toUpperCase()>t.name.toUpperCase()?1:e.name.toUpperCase()<t.name.toUpperCase()?-1:0});return r.a.createElement("div",{className:"rooms-list"},r.a.createElement("h3",null,"Your rooms"),t.map(function(t,a){var n=t.id===e.roomId?"active":"";return r.a.createElement("div",{key:a,className:"room "+n},r.a.createElement("div",{onClick:function(){return e.subscribeToRoom(t.id)}},"# ",t.name))}))},w=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={roomName:""},a.handleChange=function(e){a.setState({roomName:e.target.value})},a.handleSubmit=function(e){e.preventDefault(),a.props.handleCreateRoom(a.state.roomName),a.setState({roomName:""})},a.handleFocus=function(e){console.log("object got here?",e),a.setState({roomName:""})},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"new-room-form"},r.a.createElement("form",{onSubmit:this.handleSubmit},r.a.createElement("input",{onFocus:this.handleFocus,onChange:this.handleChange,value:this.state.roomName,type:"text",placeholder:"NewRoomForm",required:!0}),r.a.createElement("button",{id:"create-room-btn",type:"submit"},"+")))}}]),t}(r.a.Component),I={"--main-color":"#145CBE","--primary-message-color":"#000000","--secondary-message-color":"#3e5869","--main-text-color":"#FFFFFF","--secondary-text-color":"#b0c7d6","--send-message-form":"#F5F5F5","--background-color":"#FFFFFF"},N=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={userId:"",messages:[],joinableRooms:[],joinedRooms:[],roomId:null,theme:I},a.getRooms=function(){a.currentUser.getJoinableRooms().then(function(e){a.setState({joinableRooms:e,joinedRooms:a.currentUser.rooms})}).catch(function(e){console.error("error:",e)})},a.subscribeToRoom=function(e){a.setState({messages:[]}),a.currentUser.subscribeToRoom({roomId:e,messageLimit:30,hooks:{onNewMessage:function(e){return a.setState({messages:Object(m.a)(a.state.messages).concat([e])})}}}).then(function(e){a.setState({roomId:e.id}),a.getRooms()}).catch(function(e){console.error("error subscribing to room:",e)})},a.handleSendMessage=function(e){a.currentUser.sendMessage({text:e,roomId:a.state.roomId})},a.handleCreateRoom=function(e){a.currentUser.createRoom({name:e}).then(function(e){return a.subscribeToRoom(e.id)}).catch(function(e){return console.log("error with createRoom: ",e)})},a.updateCSSVariables=function(e){E()(e,function(e,t){document.documentElement.style.setProperty(t,e)})},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.updateCSSVariables(this.state.theme),this.setState({userId:this.props.match.params.userId},function(){new b.a.ChatManager({instanceLocator:"v1:us1:c6162ea6-4146-453d-b328-36e340a9508d",userId:e.state.userId,tokenProvider:new b.a.TokenProvider({url:"https://us1.pusherplatform.io/services/chatkit_token_provider/v1/c6162ea6-4146-453d-b328-36e340a9508d/token"})}).connect().then(function(t){e.currentUser=t,e.getRooms()}).catch(function(e){console.error("error:",e)})})}},{key:"render",value:function(){return r.a.createElement("div",{className:"app"},r.a.createElement(S,{subscribeToRoom:this.subscribeToRoom,roomId:this.state.roomId,rooms:Object(m.a)(this.state.joinableRooms).concat(Object(m.a)(this.state.joinedRooms))}),r.a.createElement(y,{currentUser:this.state.userId,roomId:this.state.roomId,messages:this.state.messages}),r.a.createElement(O,{disabled:!this.state.roomId,handleSendMessage:this.handleSendMessage}),r.a.createElement(w,{handleCreateRoom:this.handleCreateRoom}))}}]),t}(n.Component),k=a(11),C=a.n(k),x=a(17),R=(a(76),function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={userId:"",isExist:!1,users:""},a.fetchUsers=Object(x.a)(C.a.mark(function e(){var t,a;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/users");case 2:return t=e.sent,e.next=5,t.json();case 5:if(a=e.sent,200===t.status){e.next=8;break}throw Error(a.message);case 8:return e.abrupt("return",a);case 9:case"end":return e.stop()}},e,this)})),a.handleChange=function(e){var t=e.target.value;a.setState({userId:t}),a.state.users.some(function(e){return e.id===t})?a.setState({isExist:!0}):a.setState({isExist:!1})},a.handleSubmit=function(e){e.preventDefault(),a.state.isExist?a.props.history.push("/chat-app/".concat(a.state.userId)):a.registerNewUser(a.state.userId).then(function(e){a.props.history.push("/chat-app/".concat(e.id))}).catch(function(e){return console.log(e)})},a.registerNewUser=function(){var e=Object(x.a)(C.a.mark(function e(t){var a,n;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/register",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({userId:t})});case 2:return a=e.sent,e.next=5,a.json();case 5:if(n=e.sent,200===a.status){e.next=8;break}throw Error(n.message);case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.fetchUsers().then(function(t){e.setState({users:t})}).catch(function(e){return console.log(e)})}},{key:"render",value:function(){return r.a.createElement("div",{className:"register-container"},r.a.createElement("form",{onSubmit:this.handleSubmit,className:"register-form"},r.a.createElement("h2",{style:{textTransform:"capitalize"}},"Please enter username"),r.a.createElement("input",{type:"text",required:!0,value:this.state.userId,onChange:this.handleChange,placeholder:"Enter your username here"}),this.state.isExist?r.a.createElement("button",{className:"register-button",type:"submit"}," Login "):r.a.createElement("button",{className:"register-button",type:"submit"}," Register ")))}}]),t}(n.Component)),F=function(){return r.a.createElement("div",null,"Room not found")},U=function(e){return r.a.createElement(i.a,null,r.a.createElement(u.a,{path:"/chat-app/:userId",component:N}),r.a.createElement(u.a,{exact:!0,path:"/",component:R}),r.a.createElement(u.a,{component:F}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(c.a,null,r.a.createElement(U,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[31,2,1]]]);
//# sourceMappingURL=main.a69332e8.chunk.js.map